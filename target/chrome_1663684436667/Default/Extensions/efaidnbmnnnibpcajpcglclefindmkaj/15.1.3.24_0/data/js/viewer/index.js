/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
!function(){let e,t,n,r,a,i,o,s,c,l,d,u,f;const p=chrome.extension.getURL("viewer.html"),g=["https:","http:","file:"],m=e=>{if(!e)return!1;try{const t=new URL(e),n=t.protocol;let r=-1!==g.indexOf(n);return r="file:"===n?t.pathname.toLowerCase().endsWith(".pdf"):r,r}catch(e){return!1}};function h(e){const t=S("search");return new URLSearchParams(t).get(e)}function w(e,t){return new URLSearchParams(e).get(t)||""}function b(e){let t;try{t=localStorage.getItem(e)}catch(e){}return t}function _(e,t){try{localStorage.setItem(e,t)}catch(e){}}function y(e){try{localStorage.removeItem(e)}catch(e){}}function E(e){try{sessionStorage.removeItem(e)}catch(e){}}function S(e){let t;try{t=sessionStorage.getItem(e)}catch(e){t=""}return t}function I(e,t){try{sessionStorage.setItem(e,t)}catch(e){}}function E(e){try{sessionStorage.removeItem(e)}catch(e){}}function v(){try{setTimeout(()=>{chrome.tabs.getCurrent((function(e){_("reloadurl-"+e.id,r),window.location.href=r}))},500)}catch(e){O("fallback to native failed",e)}}!function(){if(r=w(document.location.search,"pdfurl"),!m(r))return void(a=!1);const e=S("search");(!e||w(e,"pdfurl")!==r||e.length<document.location.search)&&I("search",document.location.search),n=w(document.location.search,"pdffilename")||w(e,"pdffilename")||z(r),document.title=n;const t="/"+r+location.hash;history.replaceState({},n,t)}();const L=e=>{try{const t=new URL(b("cdnUrl")),n=[/^https:\/\/([a-zA-Z\d-]+\.){0,}(adobe|acrobat)\.com(:[0-9]*)?$/];return e===t.origin&&!!n.find(t=>t.test(e))}catch(e){return!1}};function R(e){const t={main_op:"analytics"};t.analytics=[[e]],chrome.runtime.sendMessage(t)}const C=["AdobeID","openid","DCAPI","sign_user_read","sign_user_write","sign_user_login","sign_library_read","sign_library_write","agreement_send","agreement_read","agreement_write","ab.manage","additional_info.account_type","sao.ACOM_ESIGN_TRIAL","widget_read","widget_write","workflow_read","workflow_write"],x=b("viewerImsClientId"),D=b("viewerImsClientIdSocial"),k=b("imsURL");function P(){let e=S("search");e||(e="?pdfurl="+r);return new URL(p+e)}function U(e={}){const t=new URL(k+"/ims/authorize/v1?"),n=P(),r=util.uuid(),a={csrf:r};I("csrf",r),e.sign_up?(t.searchParams.append("idp_flow","create_account"),n.hash=n.hash+"signUp=true"):n.hash=n.hash+"signIn=true",t.searchParams.append("response_type","token"),t.searchParams.append("client_id",x),t.searchParams.append("redirect_uri",n),t.searchParams.append("scope",C.join(",")),t.searchParams.append("locale",b("locale")),t.searchParams.append("state",JSON.stringify(a)),chrome.tabs.update({url:t.href,active:!0})}function B(){const e=new URL(k+"/ims/logout/v1?");e.searchParams.append("client_id",x);let t=window.location.href;t&&t.indexOf("#")>-1&&(t=t.split("#")[0]),e.searchParams.append("redirect_uri",t),chrome.tabs.update({url:e.href,active:!0})}const T={isSharePointURL:!1,isSharePointFeatureEnabled:!1,isFrictionlessEnabled:!0,featureFlags:[],isFillAndSignRegisteryEnabled:!1};class F{constructor(e){this.iframeElement=void 0,this.parentDiv=e}createIframe=e=>{const t=window.document,n=t.createElement("iframe");n.setAttribute("src",e),n.setAttribute("id","dc-view-frame"),n.setAttribute("allowfullscreen","allowfullscreen"),n.style.width="100vw",n.style.height="100vh",n.style.border="none",n.style.overflow="hidden",this.parentDiv.appendChild(n),this.iframeElement=t.getElementById("dc-view-frame")};_sendMessage=(e,t)=>{this.iframeElement&&L(t)&&function(e){var t=Date.now();return new Promise((function n(r,o){i&&a?r(a):e&&Date.now()-t>=e?o(new Error("timeout")):setTimeout(n.bind(this,r,o),30)}))}(1e6).then(n=>n&&this.iframeElement.contentWindow.postMessage(e,t))};sendFileMetaData=(e,t,n,r,a,i,o,s)=>{this._sendMessage({fileUrl:a,fileName:i,fileSize:n,acceptRanges:r,handShakeTime:t,type:e,isFrictionlessEnabled:T.isFrictionlessEnabled,isReloadOrBackForward:s},o)};sendNativeConfigs=e=>{this._sendMessage({type:"nativeConfigs",nativeConfigs:T},e)};sendRecentUrl=(e,t,n,r=!1)=>{this._sendMessage({type:"RecentUrls",permission:e,showOverlay:r,recentUrls:t},n)};sendProgress=(e,t,n,r)=>{this._sendMessage({total:t,loaded:n,type:e},r)};sendInitialBuffer=(e,t,n,r,a)=>{this._sendMessage({type:e,downLoadstartTime:t,downLoadEndTime:n,buffer:r},a)};sendBufferRanges=(e,t,n,r)=>{this._sendMessage({type:e,range:t,buffer:n},r)};preview=(e,t,n,r,a,i,o)=>{this._sendMessage({fileSize:n,type:e,fileBuffer:t,fileName:r,downLoadstartTime:a,downLoadEndTime:i},o)};openInAcrobatResponse=(e,t,n)=>{this._sendMessage({type:e,res:t},n)};postLog=(e,t,n,r,a)=>{this._sendMessage({type:e,reqId:t,message:n,error:r},a)}}function O(e,n){try{d=void 0!==d?d:"false"!==b("logAnalytics"),d&&(c&&t?c.postLog("log",l,e,n,t.origin):setTimeout(()=>{c&&t&&c.postLog("log",l,e,n,t.origin)},500))}catch(e){}}function V(){if(window.location.href.indexOf("access_token")>-1){const e=S("csrf"),t=function(){let e=new URLSearchParams(decodeURIComponent(window.location.hash).substr(1)).get("state");e||(e=new URLSearchParams(decodeURIComponent(window.location.search)).get("state"));try{const{csrf:t}=JSON.parse(e);return t}catch(t){return O(`Failed to parse state param. stateParam=${e}.`,t),null}}();E("csrf");(!e||!t||t!==e)&&(R("DCBrowserExt:Viewer:User:Error:NonMatchingCsrfToken:FailedToLogin"),O("state csrf not matching with state cookie. Triggering user logout."),B())}}function A(e,t,n,r,a){a&&e.forEach(e=>{n.has(e)&&t.searchParams.append(e,n.get(e))}),r&&e.forEach(e=>{b(e)&&t.searchParams.append(e,b(e))})}const M=()=>{try{V(),function(){try{let e=window.location.href;if(e&&e.indexOf("#")>-1){if(e.indexOf("signIn=true")>-1){R("DCBrowserExt:Viewer:Ims:Sign:In:"+(S("signInSource")?S("signInSource"):"Unknown")+":Successful"),R("DCBrowserExt:Viewer:Ims:Sign:In:Successful"),E("signInSource")}else if(e.indexOf("signUp=true")>-1){R("DCBrowserExt:Viewer:Ims:Sign:Up:"+(S("signUpSource")?S("signUpSource"):"Unknown")+":Successful"),R("DCBrowserExt:Viewer:Ims:Sign:Up:Successful"),E("signUpSource")}e=e.split("#")[0],O("URL hash detected"),window.location.href=e}}catch(e){}}();const n=window.document.getElementById("Adobe-dc-view");e=h("clen")||-1,c=new F(n);const a=(()=>{try{const e=b("cdnUrl"),n=new URL(e);L(n.origin)||(O("Invalid CDN URL detected","Invalid Origin"),v()),t||(t=n);let r=b("viewer-locale");r||(r=b("locale"));const a="false"!==b("logAnalytics"),i="false"!==b("ANALYTICS_OPT_IN"),o="true"===b("betaOptOut");n.searchParams.append("locale",r),n.searchParams.append("logAnalytics",a&&i),n.searchParams.append("callingApp",chrome.runtime.id),n.searchParams.append("betaOptOut",o);const s=b("installType")||"update";n.searchParams.append("version",`${chrome.runtime.getManifest().version}:${s}`),"false"===b("staticFteCoachmarkShown")&&n.searchParams.append("showFTECoachmark","true"),"true"===h("googlePrint")&&"false"!==S("googleAppsPrint")&&n.searchParams.append("googleAppsPrint","true");const c=["dropin!","provider!","app!"],l=["analytics","logToConsole","enableLogging","frictionless","sessionId","linearization"],d=["isReadAloudEnable","isModernViewerEnable","isDeskTop","isAcrobat","theme"],u=(b("env"),new URLSearchParams(window.location.search));A(l,n,u,!1,!0),A(d,n,u,!0,!1);let f=n.href;return c.forEach(e=>{u.forEach((t,n)=>{n.startsWith(e)&&(f=f+"&"+n+"="+t)})}),f}catch(e){O("Iframe src creation failed",e),v()}})();c.createIframe(a),window.addEventListener("message",e=>{!e.data||!L(e.origin)||o||"hsready"!==e.data.type&&"ready"!==e.data.type||(o=!0,s=(new Date).getTime(),l=e.data.requestId,"on"===e.data.killSwitch?(R("DCBrowserExt:Viewer:KillSwitch:Turned:On"),O("KillSwitch turned On","KillSwitch"),_("pdfViewer",!1),_("killSwitch","on"),setTimeout(()=>{window.location.href=r},200)):b("killSwitch")&&(R("DCBrowserExt:Viewer:KillSwitch:Turned:Off"),O("KillSwitch turned Off"),y("killSwitch")),O("Handshake done"))})}catch(e){O("Error create Iframe",e)}};function z(e){if(n)return n;let t=e;try{const n=e.split("?")[0].split("/").filter(e=>e.length>0),r=n.length>0?n[n.length-1]:"untitled";t=r;const a=r.length-4;(r.length<4||r.toLowerCase().indexOf(".pdf")!==a)&&(t+=".pdf")}catch(e){O("Error in getFileNameFromURL",e)}return t}function N(t,n){return new Promise((r,a)=>{const i=(new Date).getTime(),o=new XMLHttpRequest;o.open("GET",t.url),o.responseType="arraybuffer",o.setRequestHeader("Range",`bytes=${n.start}-${n.end}`),o.onload=()=>{if(4===o.readyState&&206===o.status)r({buffer:o.response,startTime:i,endTime:(new Date).getTime()});else if(200===o.status){const t={status:o.status,statusText:o.statusText,fileSize:e,rangeBufferSize:o.response.byteLength,range:n};a({message:"Unexpected response to get file buffer range",error:t})}else{const t={status:o.status,statusText:o.statusText,fileSize:e,range:n};a({message:"Invalid response to get file buffer ranger",error:t})}},o.onerror=e=>{a({message:"Error to get file buffer range",error:e})},o.ontimeout=e=>{a({message:"Timeout to get file buffer range due to timeout",error:e})},o.send()})}function H(e,t){"PDF"===function(e){if(e)try{var t=new URL(e).pathname;return t.substr(t.lastIndexOf(".")+1).toUpperCase()}catch(e){return""}return""}(e)&&(a=!0);const n=new XMLHttpRequest;n.open("GET",e),n.responseType="arraybuffer",n.onreadystatechange=function(){4===n.readyState&&(200!==n.status&&0!=n.status||t({buffer:n.response,mimeType:n.getResponseHeader("content-type")}))},n.send(null)}function $(t,n,i){return new Promise((o,s)=>{const c=r;if(c.startsWith("file://"))return void H(c,o);const l=new XMLHttpRequest;var d;l.open("GET",c),l.responseType="arraybuffer",n&&l.setRequestHeader("If-Range","randomrange"),l.onreadystatechange=(d=l,function(e){if(this.readyState==this.HEADERS_RECEIVED){if(!function(e,t){const n=e.getResponseHeader("content-type"),r=e.getResponseHeader("content-disposition");if(n){const e=n.toLowerCase().split(";",1)[0].trim();if(r&&/^\s*attachment[;]?/i.test(r))return!1;if("application/pdf"===e)return!0;if("application/octet-stream"===e&&r&&/\.pdf(["']|$)/i.test(r))return!0}return!1}(d))return O("Fall back to native - not pdf from headers"),v();a=!0}}),l.onprogress=function(t,n){return function(r){r.lengthComputable&&(e=r.total,t.sendProgress("progress",r.total,r.loaded,n))}}(t,i),l.onload=()=>{if(l.status>=200&&l.status<400)o({buffer:l.response,mimeType:l.getResponseHeader("content-type"),downLoadEndTime:(new Date).getTime()});else{const e={status:l.status,statusText:l.statusText};s({message:"Invalid response fetching content",error:e})}},l.onerror=e=>{s({message:"Error to download file contents",error:e})},l.ontimeout=e=>{s({message:"Timeout to download file contents",error:e})},l.send()})}function q(e,t,n=!1){chrome.history.search({text:chrome.extension.getURL("viewer.html"),startTime:0,maxResults:1e3},(function(r){const a=r.filter(e=>e.url.startsWith(chrome.extension.getURL("viewer.html"))),i=[];for(let e=0;e<a.length;++e){const{url:t,title:n}=a[e],{lastVisitTime:r}=a[e];i.push({filename:n,url:t,lastVisited:r,chromeHistory:!0})}e.sendRecentUrl(!0,i,t,n)}))}function G(e,t){switch(t.data.main_op){case"open_in_acrobat":case"fillsign":!function(e,t){const n={main_op:"open_in_acrobat"};if("fillsign"===t.data.main_op&&(n.paramName="FillnSign"),n.url=t.data.url,n.click_context="pdfviewer",n.timeStamp=Date.now(),t.data.fileBuffer){const e=new Blob([t.data.fileBuffer],{type:"application/pdf"});n.dataURL=URL.createObjectURL(e)}function r(n){"fillsign"===t.data.main_op?e.openInAcrobatResponse("FILLSIGN_IN_DESKTOP_APP",n,t.origin):e.openInAcrobatResponse("OPEN_IN_DESKTOP_APP",n,t.origin),O(`Open In Acrobat - (${t.data.main_op}) response- ${n}`)}"true"===b("isSharepointFeatureEnabled")?T.isSharePointURL?(n.workflow_name="SharePoint",n.isSharePointURL=!0,chrome.runtime.sendMessage(n,r)):util.checkForSharePointURL(n.url,e=>{n.isSharePointURL=e,n.isSharePointURL&&(n.workflow_name="SharePoint"),chrome.runtime.sendMessage(n,r)}):chrome.runtime.sendMessage(n,r)}(e,t);break;case"complete_conversion":R("DCBrowserExt:Viewer:Verbs:Conversion:Redirection"),function(e){const t={};t.main_op=e.data.main_op,t.conversion_url=decodeURIComponent(e.data.conversion_url),t.timeStamp=Date.now(),chrome.runtime.sendMessage(t)}(t);break;case"updateLocale":R("DCBrowserExt:Viewer:User:Locale:Updated"),_("viewer-locale",t.data.locale),chrome.tabs.reload();break;case"setInitialLocale":let n=!1;b("viewer-locale")||(n=!0,_("viewer-locale",t.data.locale),R("DCBrowserExt:Viewer:User:Locale:Initial")),t.data.reloadReq&&n&&chrome.tabs.reload();break;case"error-sign-in":!function(e){const t=new URL(e);t.searchParams.set("redirect_uri",P()),chrome.tabs.update({url:t.href,active:!0})}(t.data.url);break;case"deleteViewerLocale":b("viewer-locale")&&(y("viewer-locale"),chrome.tabs.reload());break;case"signin":R("DCBrowserExt:Viewer:Ims:Sign:In"),R("DCBrowserExt:Viewer:Ims:Sign:In:"+t.data.source),I("signInSource",t.data.source),U();break;case"googleSignIn":R("DCBrowserExt:Viewer:Ims:Sign:In"),R("DCBrowserExt:Viewer:Ims:Sign:In:"+t.data.source),I("signInSource",t.data.source),function(){const e=util.uuid(),t=P();t.hash=t.hash+"signIn=true";const n=new URL(k+"/ims/authorize/v1"),r={ac:util.isEdge()?"adobe.com_acrobatextension_edge_login":"adobe.com_acrobatextension_chrome_login",csrf:e};I("csrf",e),n.searchParams.append("response_type","token"),n.searchParams.append("idp_flow","social.deep_link.web"),n.searchParams.append("client_id",D),n.searchParams.append("provider_id","google"),n.searchParams.append("redirect_uri",t),n.searchParams.append("scope",C.join(",")),n.searchParams.append("locale",b("locale")),n.searchParams.append("state",JSON.stringify(r)),n.searchParams.append("xApiClientId",D),n.searchParams.append("xApiClientLocation ","google"),chrome.tabs.update({url:n.href,active:!0})}();break;case"signup":R("DCBrowserExt:Viewer:Ims:Sign:Up"),R("DCBrowserExt:Viewer:Ims:Sign:Up:"+t.data.source),I("signUpSource",t.data.source),U({sign_up:!0});break;case"fetchLocalRecents":const r=new URL(b("cdnUrl")).origin;chrome.permissions.contains({permissions:["history"],origins:["https://www.google.com/"]},e=>{if(t.data.fetchRecents){const n=t.data.showOverlay;e?q(c,r,n):(R("DCBrowserExt:Permissions:History:DialogTriggered"),chrome.permissions.request({permissions:["history"],origins:["https://www.google.com/"]},e=>{e?(R("DCBrowserExt:Permissions:History:Granted"),q(c,r,n)):(R("DCBrowserExt:Permissions:History:Denied"),c.sendRecentUrl(!1,null,r))}))}else e?c.sendRecentUrl(!0,null,r):c.sendRecentUrl(!1,null,r)});break;case"socialSignIn":R("DCBrowserExt:Viewer:Ims:Sign:In"),R("DCBrowserExt:Viewer:Ims:Sign:In:"+t.data.source),I("signInSource",t.data.source),function(e){const t=util.uuid(),n=P();n.hash=n.hash+"signIn=true";const r={idp_flow:"social.native",provider_id:"google",idp_token:e,client_id:x,state:JSON.stringify(Object.assign({},window.adobeid&&window.adobeid.api_parameters&&window.adobeid.api_parameters.authorize&&window.adobeid.api_parameters.authorize.state,{ac:util.isEdge()?"adobe.com_acrobatextension_edge_login":"adobe.com_acrobatextension_chrome_login",csrf:t})),scope:C.join(","),response_type:"token",redirect_uri:n,device_id:t};I("csrf",t);const a=new URL(k+"/ims/authorize/v1"),i=window.document,o=i.getElementById("google-yolo-authorize-form");o.setAttribute("action",a),Object.entries(r).forEach(([e,t])=>{const n=i.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("id",e),n.setAttribute("name",e),n.setAttribute("value",t),o.appendChild(n)}),o.submit()}(t.data.idp_token)}}function W(a,o,l,d,u){i=!0;const f=r,p=h("chunk")||"false",g=window.performance.getEntriesByType("navigation").map(e=>e.type).includes("reload"),m=window.performance.getEntriesByType("navigation").map(e=>e.type).includes("back_forward");a.sendFileMetaData("metadata",s,e,p,encodeURI(f),n,o.origin,g||m),l?(R("DCBrowserExt:Viewer:Linearization:Range:Supported"),O("Range call supported"),l.then(e=>{a.sendInitialBuffer("initialBuffer",e.startTime,e.endTime,e.buffer,o.origin),function(e){try{const n=new TextDecoder("utf-8").decode(e.buffer);let r=!1;-1!=n.indexOf("Linearized 1")?(r=!0,R("DCBrowserExt:Viewer:Linearization:Linearized:Version:1"),O("Linearized PDF v1 detected")):-1!=n.indexOf("Linearized")?(R("DCBrowserExt:Viewer:Linearization:Linearized:Version:Other"),O("Linearized PDF other version detected")):(R("DCBrowserExt:Viewer:Linearization:Linearized:False"),O("Non Linearized PDF detected")),c._sendMessage({type:"Linearization",linearized:r},t.origin)}catch(e){R("DCBrowserExt:Viewer:Linearization:Linearized:Detection:Failed"),O("Linearization Detection failed",e)}}(e)}).catch(e=>{a.sendInitialBuffer("initialBuffer",0,0,-1,o.origin),R("DCBrowserExt:Viewer:Error:Linearization:InitialBuffer:Failed"),O("Initial buffer download failed",e)})):(R("DCBrowserExt:Viewer:Linearization:Range:Not:Supported"),O("Range call not supported"),a.sendInitialBuffer("initialBuffer",0,0,-1,o.origin)),d.then(r=>{const i=r.downLoadEndTime,s=r.buffer;r.buffer.byteLength;a.preview("preview",s,e,n,u,i,o.origin),c._sendMessage({type:"NavigationStartTime",time:window.performance&&window.performance.timing&&window.performance.timing.navigationStart},t.origin)}).catch(e=>(R("DCBrowserExt:Viewer:Error:FallbackToNative:FileDownload:Failed"),O("File download failed, falling back to native viewer",e),v())),O("Viewer loaded")}function j(e,t,n,a){return i=>{try{if(i.data&&i.origin&&L(i.origin)&&(e=>{try{return e&&e.source&&e.source.top.location.origin==="chrome-extension://"+chrome.runtime.id}catch(e){return!1}})(i)){if(i.data.main_op)return G(e,i);switch(i.data.type){case"ready":W(e,i,n,t,a);break;case"getFileBufferRange":!function(e,t){N({url:r},e.data.range).then(n=>{f||(R("DCBrowserExt:Viewer:Linearization:Range:Called"),O("Range call received"),f=!0),t.sendBufferRanges("bufferRanges",`${e.data.range.start}-${e.data.range.end}`,n.buffer,e.origin)}).catch(n=>{R("DCBrowserExt:Viewer:Error:Linearization:Range:Failed"),O(`Range buffer download failed for ${e.data.range.start}-${e.data.range.end}`,n),t.sendBufferRanges("bufferRanges",`${e.data.range.start}-${e.data.range.end}`,-1,e.origin)})}(i,e);break;case"previewFailed":u||(R("DCBrowserExt:Viewer:Error:FallbackToNative:Preview:Failed"),O("File preview failed, falling back to native viewer","previewFailed"),u=!0,v());break;case"signin":R("DCBrowserExt:Viewer:Ims:Sign:In"),U();break;case"signout":R("DCBrowserExt:Viewer:Ims:Sign:Out"),y("viewer-locale"),B();break;case"coachMarkClosed":_("staticFteCoachmarkShown","true"),R("DCBrowserExt:Staticpdf:fte:CoachMark:Closed");break;case"coachmarkManageSettings":chrome.runtime.openOptionsPage(),_("staticFteCoachmarkShown","true"),R("DCBrowserExt:Staticpdf:fte:CoachMark:ManageSettings:clicked");break;case"coachMarkDisplayed":_("staticFteCoachmarkShown","true"),R("DCBrowserExt:Staticpdf:fte:CoachMark:Shown");break;case"googleAppsPrintShown":I("googleAppsPrint","false"),R("DCBrowserExt:Viewer:GoogleApps:Print:Shown");break;case"signInExperimentShown":chrome.tabs.query({active:!0,currentWindow:!0},(function(e){const t=e[0],n=(new Date).getTime();_("signInExperimentShown",JSON.stringify({currTabId:t.id,timestamp:n}))}));break;case"signInExperimentClosed":case"signInExperimentSkipped":_("signInExperimentSuppressed","true");break;case"enableBeta":_("betaOptOut",!1),chrome.tabs.reload();break;case"disableBeta":_("betaOptOut",!0),chrome.tabs.reload()}}}catch(e){R("DCBrowserExt:Viewer:Error:MessageHandler:Unknown"),O("Unknown error","MessageHandler")}}}function K(){if(!o)return R("DCBrowserExt:Viewer:Error:Handshake:TimedOut"),O("Handshake timed out - falling back to native","Timeout"),v(),!1}function J(e){const t=document.getElementById("__acrobatDialog__");t&&0!==t.length?t&&"none"===t.style.display&&"visible"===e.frame_visibility?t.style.display="block":t&&e.trefoilClick&&(delete e.trefoilClick,t.remove()):function(e){const t=e.base64PDF;delete e.base64PDF;const n="message="+encodeURIComponent(JSON.stringify(e));e.base64PDF=t;const r=null===e.locale;let a=e.version>13||r?"210px":"130px",i="block";"hidden"===e.frame_visibility&&(i="none");const o=document.createElement("iframe");o.setAttribute("src",`${chrome.extension.getURL("data/js/frame.html")}?${n}`),o.setAttribute("id","__acrobatDialog__"),o.style.border="0px",o.style.zIndex="999999999999",o.style.position="fixed",o.style.top="-5px",o.style.right="80px",o.style.width="294px",o.style.height=a,o.style.display=i,o.style.margin="auto",document.getElementById("trefoil_m").appendChild(o)}(e)}(()=>{try{if(!m(r))return void(a=!1);M();const e=h("clen")||-1,i=h("chunk")||!1,o="false"!==h("linearization"),s={url:r},l=(new Date).getTime(),d=new URL(b("cdnUrl"));n=h("pdffilename")||z(r),document.title=decodeURIComponent(n),t||(t=d);let u=null;const f=o&&i&&e>0;f&&(u=N(s,{start:0,end:1024}));const p=$(c,f,d.origin);window.addEventListener("message",j(c,p,u,l)),setTimeout(K,25e3)}catch(e){O("InitScript failed",e),v()}})(),document.addEventListener("DOMContentLoaded",function(e){const t=(new Date).getTime();var n=window.setInterval((function(){(function(){const e=document.getElementById("dc-view-frame");return e&&e.contentWindow&&1===e.contentWindow.length}()||(new Date).getTime()-t>15e3)&&(window.clearInterval(n),e.call(this))}),200)}((function(){const e=document.getElementById("dc-view-frame");e&&e.contentWindow&&e.contentWindow.focus()}))),void 0!==chrome.runtime&&(chrome.runtime.onMessage.addListener((function(e){if(e.panel_op&&(1==e.trefoilClick?(delete e.trefoilUI,delete e.newUI,J(e)):!0===e.reload_in_native&&(delete e.is_viewer,chrome.tabs.reload(e.tabId))),"relay_to_content"!==e.main_op||"dismiss"!==e.content_op)return"reset"===e.main_op&&c._sendMessage({type:"toggleAnalytics",logAnalytics:e.analytics_on},t.origin),!1;{delete e.content_op,delete e.trefoilClick,delete e.reload_in_native;let t=document.getElementById("__acrobatDialog__");t&&(t.remove(),t=null)}})),chrome.runtime.sendMessage({main_op:"viewer-startup",url:document.location.href,startup_time:Date.now(),viewer:!0},e=>{T.isSharePointURL=!!e.isSharePointURL,T.isSharePointFeatureEnabled=!!e.isSharePointEnabled,T.isFrictionlessEnabled=!!e.isFrictionlessEnabled,T.featureFlags=e.featureFlags,T.isFillAndSignRegisteryEnabled=e.isFillnSignEnabled,c.sendNativeConfigs(t.origin)}),chrome.runtime.sendMessage({main_op:"get-features&groups",cachePurge:"LAZY"},e=>c._sendMessage({type:"featureGroups",featureGroups:e.featureGroups,featureFlags:e.featureFlags},t.origin))),window.addEventListener("storage",(function(e){"theme"===e.key&&c._sendMessage({type:"themeChange",theme:b("theme")},t.origin)}))}();