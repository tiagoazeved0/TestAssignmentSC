/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
function dependOn(){"use strict";return[require("common"),require("util"),require("analytics"),require("floodgate"),require("constant")]}var def;require=function(e){"use strict";return e},def=window.define?window.define:function(e,t){"use strict";return t.apply(null,[{ajax:$.ajax.bind($)}])};var exports=acom_analytics={};def(dependOn(),(function(e,t,n,r){"use strict";var o=null,a=!1,i=chrome.extension.getURL("viewer.html"),s=chrome.extension.getURL("/"),c=!1;function l(e){let t=i;if(t+="?pdfurl="+encodeURIComponent(e.url),void 0!==e.responseHeaders){const n=p(e.responseHeaders,"content-length");n&&(t+="&clen="+n.value);const r=p(e.responseHeaders,"accept-ranges");r&&r.value&&"bytes"===r.value.toLowerCase()&&(t+="&chunk=true");const o=p(e.responseHeaders,"content-disposition");if(o&&o.value&&/\.pdf(["']|$)/i.test(o.value)){const e=/filename[^;=\n\*]?=((['"]).*?\2|[^;\n]*)/.exec(o.value);if(null!=e&&e.length>1){t+="&pdffilename="+e[1].replace(/['"]/g,"")}}}return function(e){const t=new URL(e.url),n=new URLSearchParams(t.search);let r=!1;const o=e.initiator;o&&["https://classroom.google.com","https://mail.google.com","https://drive.google.com"].includes(o)&&n.forEach((e,t)=>{t.startsWith("print")&&"true"===e&&(r=!0)});return r}(e)&&(t+="&googlePrint=true"),t}function u(){try{let o=0!=communicate.version&&1!=communicate.version,a=!(!o||communicate.version===SETTINGS.READER_VER||communicate.version===SETTINGS.ERP_READER_VER);localStorage.setItem("locale",t.getFrictionlessLocale(chrome.i18n.getMessage("@@ui_locale"))),localStorage.setItem("cdnUrl",e.getAcrobatViewerUri()),localStorage.setItem("isDeskTop",o),localStorage.setItem("env",e.getEnv()),localStorage.setItem("viewerImsClientId",e.getViewerIMSClientId()),localStorage.setItem("viewerImsClientIdSocial",e.getViewerIMSClientIdSocial()),localStorage.setItem("imsURL",e.getIMSurl()),localStorage.setItem("isAcrobat",a),n={flag:"dc-cv-use-old-domain"},r.hasFlag(n.flag).then(t=>{e.setOldDomainRollback(!!t)}),d({flag:"dc-cv-modern-viewer",storageKey:"modernViewerEnable"}),d({flag:"dc-cv-dark-mode",storageKey:"darkModeEnable"}).then(e=>{localStorage.getItem("theme")&&!e?localStorage.removeItem("theme"):e&&!localStorage.getItem("theme")&&localStorage.setItem("theme","auto")}),d({flag:"dc-cv-read-aloud",storageKey:"isReadAloudEnable"})}catch(e){}var n}function d(e){return r.hasFlag(e.flag).then(t=>(e.storageKey&&localStorage.setItem(e.storageKey,!!t),t))}function m(e){if(!SETTINGS.IS_READER&&SETTINGS.USE_ACROBAT&&0!=communicate.version&&(1!=communicate.version||0!=t.getNMHConnectionStatus())&&e.url){const t=new URL(e.url);chrome.runtime.id===t.host?(chrome.contextMenus.update("convertPageContextMenu",{visible:!1}),chrome.contextMenus.update("appendPageContextMenu",{visible:!1})):(chrome.contextMenus.update("convertPageContextMenu",{visible:!0}),chrome.contextMenus.update("appendPageContextMenu",{visible:!0}))}}function f(e){const n=new Date;n.setMinutes(n.getMinutes()+SETTINGS.VIEWER_RECHECK_CDN_ACCESS_DELAY_MINS),t.setCookie("netAccAdT",n.getTime()),t.setCookie("netAcc",e)}chrome.extension.isAllowedFileSchemeAccess((function(e){c=e})),chrome.tabs.onActivated.addListener((function(e){chrome.tabs.get(e.tabId,(function(e){chrome.runtime.lastError||m(e)}))}));function E(){try{return"true"===t.getCookie("pdfViewer")}catch(e){return!1}}function p(e,t){for(var n=0;n<e.length;++n){var r=e[n];if(r.name.toLowerCase()===t)return r}}function g(e){if(void 0!==e.responseHeaders){const t=p(e.responseHeaders,"content-type"),r=p(e.responseHeaders,"content-disposition");if(t){const e=t.value.toLowerCase().split(";",1)[0].trim();if(r&&/^\s*attachment[;]?/i.test(r.value))return"application/pdf"===e||"application/octet-stream"===e?n.event(n.e.VIEWER_PDF_ATTACHMENT_IGNORED):n.event(n.e.VIEWER_ATTACHMENT_IGNORED),!1;if("application/pdf"===e)return a||n.event(n.e.VIEWER_PDF_PROCESS_PDF),!0;if("application/octet-stream"===e&&r&&/\.pdf(["']|$)/i.test(r.value))return n.event(n.e.VIEWER_PDF_PROCESS_OS_CD),!0}}else if("file"==(t=e.url,r=t.indexOf("/"),t.substr(0,r-1))&&"PDF"==function(e){if(e)try{var t=new URL(e).pathname;return t.substr(t.lastIndexOf(".")+1).toUpperCase()}catch(e){return""}return""}(e.url))return!0;var t,r;return!1}function h(e,t){e&&t&&chrome.tabs.update(e,{url:t})}function v(e,r){const i="true"===localStorage.getItem("modernViewerEnable");if(localStorage.setItem("isModernViewerEnable",!!i),u(),"main_frame"===e.type){if(!function(){if(!window.navigator.onLine)return!1;const e=new Date,n=t.getCookie("netAcc"),r=t.getCookie("netAccAdT");return!(r&&r>e.getTime())||"true"===n}()||!function(e){if("GET"!==e.method||!SETTINGS.VIEWER_ENABLED||!E())return!1;var r=e.url;let o="reloadurl-"+e.tabId;const i=t.getCookie(o);if(i&&i===r){try{localStorage.removeItem(o)}catch(e){}return!1}if(!(e=>{if(!e||null===e||"undefined"===e)return!1;return!![/^http\:\/\/[^/]/,/^https\:\/\/[^/]/,/^file?:/].find(t=>t.test(e))&&![/^chrome\:\/\//,/^chrome\-extension\:\/\//,/^https:\/\/([a-zA-Z\d-]+\.){0,}officeapps.live.com/,/^https\:\/\/*.*\/(saml|login)/,/^https:\/\/sharedcloud.([a-zA-Z\d-]+)+.(s3|s3-accelerate).amazonaws.com/,/^https\:\/\/*.*.(login|auth|okta|saml).*\/S*|(login|auth|okta|saml|IWA|owa)\//,/^https\:\/\/www.google.com\/search\?q/,/^https\:\/\/www.citibank.*/,/^https:\/\/[^/]*\.*\/([$-/:-?{-~!"^_`\[\]A-Za-z0-9]*)view-sdk/].find(t=>t.test(e))})(r))return!1;const s=g(e);return a?(s&&n.event(n.e.VIEWER_FALLBACK_TO_NATIVE_INCOGNITO),!1):s}(e))return;if(r&&!c)return void n.event(n.e.VIEWER_PDF_LOCAL_FILE_IGNORED);if(o=e.url,r)n.event(n.e.VIEWER_PDF_LOCAL_FILE);else{const{origin:e}=new URL(o);n.setArg("pdfDomain",e),n.event(n.e.VIEWER_PDF_DETECT_HEADERS),n.setArg("pdfDomain",null)}var s=l(e);return n.event(n.e.VIEWER_EXTN_PDF_OPENED),{redirectUrl:s}}var d;"sub_frame"===e.type&&(d=e.url,/^https:\/\/[^/]*(acrobat|adobe)\.com\/proxy\/chrome-viewer/.test(d))&&(200!==e.statusCode?403===e.statusCode?(t.setCookie("pdfViewer",!1),n.event(n.e.VIEWER_FALLBACK_TO_NATIVE_CDN_FORBIDDEN),h(e.tabId,o)):(f(!1),n.event(n.e.VIEWER_FALLBACK_TO_NATIVE_CDN_OFFLINE),h(e.tabId,o)):f(!0))}chrome.tabs.onUpdated.addListener((e,n,r)=>{if(a=r.incognito,"complete"===r.status&&m(r),"loading"===n.status)try{new URL(r.url);!t.isViewerURL(r.url)||E()&&!a||h(e,function(e,t){t||(t=window.location.href);try{const n=new URL(t);return new URLSearchParams(n.search).get(e)}catch(e){return}}("pdfurl",r.url))}catch(e){}}),chrome.webRequest.onHeadersReceived.addListener((function(e){return v(e,!1)}),{urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame"]},["responseHeaders","blocking"]),chrome.webRequest.onBeforeRequest.addListener((function(e){return v(e,!0)}),{urls:["file://*/*.pdf","file://*/*.PDF"],types:["main_frame","sub_frame"]},["blocking"]),chrome.webRequest.onBeforeRequest.addListener((function(e){var r=t.parseExtensionURL(e.url);if(r){r=i+"?pdfurl="+r;var o=e.url.indexOf("#");return o>0&&(r+=e.url.slice(o)),SETTINGS.VIEWER_ENABLED&&E()&&!a&&n.event(n.e.VIEWER_EXTN_PDF_OPENED),{redirectUrl:r}}}),{types:["main_frame","sub_frame"],urls:["http","https","ftp","file","blob","data","filesystem","drive"].map((function(e){return s+e+"*"}))},["blocking"])}));