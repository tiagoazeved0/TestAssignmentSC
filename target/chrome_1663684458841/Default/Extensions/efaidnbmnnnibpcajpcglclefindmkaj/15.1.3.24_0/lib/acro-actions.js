/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
function dependOn(){"use strict";return[require("communicate"),require("common"),require("util"),require("proxy"),require("analytics"),require("acro-web2pdf"),require("sharepoint-module")]}var def;require=function(e){"use strict";return e},def=window.define?window.define:function(e,n){"use strict";return n.apply(null,[{ajax:$.ajax.bind($)}])};var exports=acom_analytics={};def(dependOn(),(function(e,n,t,o,r,i,a){"use strict";var s,u=null;for(s in u||(u=new function(){this.proxy=o.proxy.bind(this),this.LOG=n.LOG;const s=0,u=1,c=2,l="pdf_downloaded",E="pdf_downloading",I="pdf_failure";function _(e,n){if(!("pdfviewer"===e.click_context))return;const t="SharePoint"===e.workflow_name||e.isSharePointURL,o="FillnSign"===e.paramName;switch(n){case s:o?t?r.event(r.e.VIEWER_SHAREPOINT_FILLSIGN_CLICKED):r.event(r.e.VIEWER_FILLSIGN_CLICKED):t?r.event(r.e.VIEWER_SHAREPOINT_CLICKED):r.event(r.e.VIEWER_OPEN_IN_ACRO_CLICKED);break;case u:t?o?r.event(r.e.VIEWER_SHAREPOINT_FILLSIGN_CLICKED_COMPLETE):r.event(r.e.VIEWER_SHAREPOINT_CLICKED_COMPLETE):o?r.event(r.e.VIEWER_FILLSIGN_CLICKED_COMPLETE):r.event(r.e.VIEWER_OPEN_IN_ACRO_CLICKED_COMPLETE);break;case c:o?r.event(r.e.VIEWER_FILLSIGN_CLICKED_FAILED):r.event(r.e.VIEWER_OPEN_IN_ACRO_CLICKED_FAILED)}}function d(n,t){n.panel_op="status",n.current_status=t,e.sendMessage({tabId:n.tabId,loaded:n.loaded,filename:n.filename,url:n.url,persist:n.persist,version:n.version,start:n.start,is_pdf:n.is_pdf,newUI:n.newUI,panel_op:n.panel_op,content_op:n.content_op,click_context:n.click_context,current_status:n.current_status})}this.getVersion=function(n){var o,s=function(i){if(i){clearTimeout(o),function(e){e.fillnSignEnabled&&"true"===e.fillnSignEnabled?SETTINGS.FILL_N_SIGN_ENABLED=!0:SETTINGS.FILL_N_SIGN_ENABLED=!1}(i),function(e){e.frictionlessEnabled&&"false"===e.frictionlessEnabled?SETTINGS.FRICTIONLESS_ENABLED=!1:SETTINGS.FRICTIONLESS_ENABLED=!0}(i),function(e){const n="true"===e.sharePointEnabled;a.setFeatureEnabled(n),n&&a.handleAllowedListFromNativeHost(e.sharePointUrlString),localStorage.setItem("isSharepointFeatureEnabled",a.isFeatureEnabled())}(i),function(n){const o=+n.majorVersion;e.setVersion(o),1==n.isdummy&&t.setNMHConnectionStatus(!1)}(i),function(e){if(t.setCookie("ANALYTICS_OPT_IN","false"!==e.optinState),e.optinState&&"false"===e.optinState)SETTINGS.ANALYTICS_OPT_IN=!1;else{const n=+e.majorVersion;1===n?(r.event(r.e.SHIM_VERSION,{VERSION:"Unknown"}),r.shim="unknown"):0===n?(r.event(r.e.SHIM_VERSION,{VERSION:"None"}),r.shim="none"):(r.event(r.e.SHIM_VERSION,{VERSION:e.majorVersion+"."+e.minorVersion}),r.shim=e.majorVersion+"."+e.minorVersion)}}(i);var s=function(e){let n={0:"Admin",1:"RDC",2:"FTE",3:"Other",4:"None"}[e];return n||"Unknown"}(i.installSource);n(+i.majorVersion,s)}};o=setTimeout((function(){s({messageType:"shimVersionInfo",majorVersion:"1",minorVersion:"0",isdummy:!0})}),2e3),i.getVersion(s)},this.openInAcrobat=function(n,o,r){var a=this;return chrome.tabs.get(n.tabId,(function(o){if(o.url&&!/chrome\-extension/.test(o.url)&&(n.url=o.url),_(n,s),function(n){void 0===n.filename&&(n.filename=e.filenameFromUrl(n.url))}(n),e.version>1){if(!0===n.isSharePointURL)return i.openInAcrobat(n),d(n,l),r&&r("OP_SUCCESS"),void _(n,u);if(n.authenticatedPDF&&1==n.authenticatedPDF)return delete n.authenticatedPDF,n.current_status===l&&n.base64PDF&&i.openInAcrobat(n),void e.sendMessage(n);d(n,E),function(n,o,r){d(o,E);var a=t.newXHR();o.dataURL?a.open("GET",o.dataURL,!0):a.open("GET",o.url,!0),a.responseType="blob",a.onload=n.proxy((function(n){var t;a.status<400?"application/pdf"===a.response.type?((t=new FileReader).onloadend=function(e){o.base64PDF=e.target.result,i.openInAcrobat(o),d(o,E)},t.readAsDataURL(a.response),r&&r("OP_SUCCESS"),_(o,u)):(o.authenticatedPDF=!0,e.sendMessage(o)):(d(o,I),_(o,c),r&&r("OP_FAILURE"))})),a.send()}(a,n,r)}else chrome.downloads.download({url:n.url,conflictAction:"uniquify"}),r&&r("APP_NOT_INSTALLED")})),!0},this.openConvertedFile=function(e){i.openFile(e)}}),u)u.hasOwnProperty(s)&&("function"==typeof u[s]?exports[s]=u[s].bind(u):exports[s]=u[s]);return e.registerHandlers({open_in_acrobat:u.proxy(u.openInAcrobat),open_converted_file:u.proxy(u.openConvertedFile)}),u}));